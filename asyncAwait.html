<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // Simulating an API call
      //   function getUserData(userId) {
      //     return new Promise((resolve) => {
      //       setTimeout(() => {
      //         resolve({
      //           id: userId,
      //           name: `User ${userId}`,
      //           email: `user${userId}@example.com`,
      //         });
      //       }, 5000);
      //     });
      //   }

      //   // Traditional Promise way
      //   function getUserWithPromise(userId) {
      //     return getUserData(userId)
      //       .then((data) => {
      //         console.log(data);
      //         return data;
      //       })
      //       .catch((error) => {
      //         console.error(error);
      //       });
      //   }

      //   // Async/Await way - Much cleaner!
      //   async function getUserWithAsync(userId) {
      //     try {
      //       console.log("Before await");
      //       const data = await getUserData(userId);
      //       console.log("After await");
      //       console.log(data);
      //       return data;
      //     } catch (error) {
      //       console.error(error);
      //     }
      //   }

      //   // Test it
      //   getUserWithAsync(123).then((user) => {
      //     console.log("User fetched:", user);
      //   });

      //   // Example 2: Simple Async Function

      //   // Simulating a database query
      //   function queryDatabase(query) {
      //     return new Promise((resolve) => {
      //       setTimeout(() => {
      //         resolve(`Results for: ${query}`);
      //       }, 1000);
      //     });
      //   }

      //   // Using async/await
      //   async function searchDatabase() {
      //     console.log("Starting search...");
      //     const result = await queryDatabase("SELECT * FROM users");
      //     console.log("Search complete:", result);
      //     return result;
      //   }

      //   // Calling an async function
      //   searchDatabase().then((finalResult, error) => {
      //     console.log("Final:", finalResult);
      //   });

      //   console.log("This runs immediately");

      // Example 3: Sequential Operations

      function fetchUserData(userId) {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ id: userId, name: `User ${userId}` });
          }, 1000);
        });
      }

      function fetchUserPosts(userId) {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve([
              { id: 1, title: "Post 1" },
              { id: 2, title: "Post 2" },
            ]);
          }, 1000);
        });
      }

      function fetchPostComments(postId) {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve([
              { id: 1, text: "Great post!" },
              { id: 2, text: "Thanks for sharing!" },
            ]);
          }, 1000);
        });
      }

      // Sequential execution with async/await
      //   async function getUserCompleteData(userId) {
      //     // fetchUserData(userId)
      //     //   .then((user) => {
      //     //     console.log("User:", user);
      //     //     fetchUserPosts(user.id)
      //     //       .then((posts) => {
      //     //         console.log("Posts:", posts);
      //     //         fetchPostComments(posts[0].id)
      //     //           .then((comments) => {
      //     //             console.log("Comments:", comments);
      //     //           })
      //     //           .catch((error) => {
      //     //             console.error("Error fetching comments:", error);
      //     //           });
      //     //       })
      //     //       .catch((error) => {
      //     //         console.error("Error fetching posts:", error);
      //     //       });
      //     //   })
      //     //   .catch((error) => {
      //     //     console.error("Error fetching user data:", error);
      //     //   });
      //     try {
      //       console.log("Step 1: Fetching user data...");
      //       const user = await fetchUserData(userId);
      //       console.log("User:", user);

      //       console.log("Step 2: Fetching user posts...");
      //       const posts = await fetchUserPosts(user.id);
      //       console.log("Posts:", posts);

      //       console.log("Step 3: Fetching comments for first post...");
      //       const comments = await fetchPostComments(posts[0].id);
      //       console.log("Comments:", comments);

      //       return { user, posts, comments };
      //     } catch (error) {
      //       console.error("Error during data fetching:", error);
      //     }
      //   }

      //   // Usage
      //   getUserCompleteData(123).then((allData) => {
      //     console.log("All data loaded:", allData);
      //   });

      //   Example 4: Parallel Operations with Async/Await
      function downloadFile(fileName, time) {
        return new Promise((resolve) => {
          setTimeout(() => {
            console.log(`${fileName} downloaded`);
            resolve(`${fileName} content`);
          }, time);
        });
      }

      // Wrong way - Sequential (slower)
      async function downloadFilesSequential() {
        console.log("Starting sequential downloads...");
        const startTime = Date.now();

        const file1 = await downloadFile("file1.pdf", 2000);
        const file2 = await downloadFile("file2.jpg", 2000);
        const file3 = await downloadFile("file3.mp4", 2000);

        const endTime = Date.now();
        console.log(`Sequential took: ${endTime - startTime}ms`);
        return [file1, file2, file3];
      }

      // Right way - Parallel (faster)
      async function downloadFilesParallel() {
        console.log("Starting parallel downloads...");
        const startTime = Date.now();

        // Start all downloads at once
        const promise1 = downloadFile("file1.pdf", 2000);
        const promise2 = downloadFile("file2.jpg", 2000);
        const promise3 = downloadFile("file3.mp4", 2000);

        // Wait for all to complete
        const [file1, file2, file3] = await Promise.all([
          promise1,
          promise2,
          promise3,
        ]);

        const endTime = Date.now();
        console.log(`Parallel took: ${endTime - startTime}ms`);
        return [file1, file2, file3];
      }

      // downloadFilesSequential(); // Takes ~6 seconds
      downloadFilesParallel(); // Takes ~2 seconds
    </script>
  </body>
</html>
