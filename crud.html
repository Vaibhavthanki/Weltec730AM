<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD Form</title>
    <style>
      table {
        width: 100%;
        border-collapse: collapse;
      }
      table,
      th,
      td {
        border: 1px solid black;
      }
      th,
      td {
        padding: 10px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <h1>CRUD Form</h1>

    <form id="userForm">
      <label for="username">Username:</label>
      <input
        type="text"
        id="username"
        name="username"
        onblur="validateField(this)"
        onchange="validateField(this)"
      />
      <br />
      <label for="email">Email:</label>
      <input
        type="email"
        id="email"
        name="email"
        onblur="validateField(this)"
        onchange="validateField(this)"
      />
      <br />
      <label for="age">Age:</label>
      <input
        type="number"
        id="age"
        name="age"
        onblur="validateField(this)"
        onchange="validateField(this)"
      />
      <br />
      <button type="submit">Submit</button>
    </form>

    <h2>User List</h2>
    <table id="userTable">
      <thead>
        <tr>
          <th>Username</th>
          <th>Email</th>
          <th>Age</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      // Initialize users array from local storage
      let users = JSON.parse(localStorage.getItem("users")) || [];

      // Render users in table
      function renderUsers() {
        const tableBody = document
          .getElementById("userTable")
          .getElementsByTagName("tbody")[0];
        tableBody.innerHTML = ""; // Clear the table

        users.forEach((user, index) => {
          const row = tableBody.insertRow();
          row.insertCell(0).innerText = user.username;
          row.insertCell(1).innerText = user.email;
          row.insertCell(2).innerText = user.age;

          // Add edit and delete buttons
          const actionsCell = row.insertCell(3);
          const editButton = document.createElement("button");
          editButton.innerText = "Edit";
          editButton.onclick = () => editUser(index);
          const deleteButton = document.createElement("button");
          deleteButton.innerText = "Delete";
          deleteButton.onclick = () => deleteUser(index);
          actionsCell.appendChild(editButton);
          actionsCell.appendChild(deleteButton);
        });
      }

      // Add or Edit user
      function addOrEditUser(event) {
        event.preventDefault();

        const username = document.getElementById("username").value;
        const email = document.getElementById("email").value;
        const age = document.getElementById("age").value;

        if (!username || !email || !age) {
          alert("All fields are required!");
          return;
        }

        const user = { username, email, age };

        // Check if editing an existing user
        const index = document.getElementById("userForm").dataset.editIndex;
        if (index !== undefined) {
          users[index] = user;
        } else {
          users.push(user);
        }

        // Save users to local storage
        localStorage.setItem("users", JSON.stringify(users));

        // Clear form and render updated user list
        document.getElementById("userForm").reset();
        delete document.getElementById("userForm").dataset.editIndex;
        renderUsers();
      }

      // Edit user
      function editUser(index) {
        console.log(index, "check19");

        const user = users[index];
        document.getElementById("username").value = user.username;
        document.getElementById("email").value = user.email;
        document.getElementById("age").value = user.age;
        document.getElementById("userForm").dataset.editIndex = index;
      }

      // Delete user
      function deleteUser(index) {
        users.splice(index, 1);
        localStorage.setItem("users", JSON.stringify(users));
        renderUsers();
      }

      // Validate form fields
      function validateField(field) {
        const value = field.value.trim();
        if (!value) {
          field.style.borderColor = "red";
        } else {
          field.style.borderColor = "";
        }
      }

      // Initialize form submission handler
      document
        .getElementById("userForm")
        .addEventListener("submit", addOrEditUser);

      // Initial render of users
      renderUsers();
    </script>
  </body>
</html>
